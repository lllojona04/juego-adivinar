<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Racing de Santander - Edici√≥n Definitiva</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap');

    :root {
      --racing-green: #006a38;
      --racing-dark: #004d29;
      --accent-gold: #c5a059;
      --error-red: #e74c3c;
      --white: #ffffff;
      --bg-gradient: linear-gradient(135deg, #004d29 0%, #000000 100%);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-gradient);
      color: var(--white);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Contenedores */
    .container {
      width: 90%;
      max-width: 480px;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      border-radius: 24px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
      position: relative;
      transition: transform 0.3s ease;
      z-index: 10;
    }

    h1 {
      color: var(--racing-green);
      font-weight: 800;
      text-transform: uppercase;
      font-size: 1.8rem;
      margin-bottom: 10px;
      letter-spacing: -1px;
    }

    h2 { font-size: 1.4rem; color: var(--racing-dark); margin-bottom: 15px; }
    
    .stats-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      font-size: 0.9rem;
      font-weight: 600;
      color: #666;
    }

    /* Imagen del Jugador */
    .image-wrapper {
      position: relative;
      width: 100%;
      height: 350px;
      margin: 20px 0;
      border-radius: 16px;
      overflow: hidden;
      background: #eee;
      border: 4px solid var(--racing-green);
      box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
    }

    .image-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: top center;
      transition: clip-path 0.5s cubic-bezier(0.4, 0, 0.2, 1), filter 0.5s ease;
      clip-path: circle(15% at 50% 20%); 
      filter: grayscale(100%);
    }

    /* Nombre revelado */
    #revealName {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 106, 56, 0.95);
      color: white;
      padding: 15px;
      font-weight: bold;
      font-size: 1.3rem;
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 20;
    }
    
    .revealed #revealName { transform: translateY(0); }

    /* Inputs y Botones */
    input[type="text"] {
      width: 100%;
      padding: 15px;
      font-size: 1rem;
      border: 2px solid #ddd;
      border-radius: 12px;
      margin-bottom: 15px;
      text-align: center;
      font-family: inherit;
      outline: none;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus { border-color: var(--racing-green); }

    button {
      width: 100%;
      padding: 15px;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: white;
      margin-bottom: 10px;
    }

    button:active { transform: scale(0.98); }

    .btn-primary { background: var(--racing-green); box-shadow: 0 4px 15px rgba(0, 106, 56, 0.3); }
    .btn-primary:hover { background: var(--racing-dark); }
    
    .btn-next { background: var(--accent-gold); color: #000; display: none; }
    .btn-next:hover { background: #d4ac5e; }

    .btn-restart { background: #333; }
    .btn-exit { background: var(--error-red); }

    /* Control de volumen */
    #soundToggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 10px;
      border-radius: 50%;
      z-index: 100;
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #soundToggle:hover { background: rgba(255,255,255,0.4); }

    /* Vidas y Mensajes */
    .game-info { min-height: 70px; }
    
    .lives-container { font-size: 1.5rem; margin-top: 5px; letter-spacing: 5px; }
    
    .message { font-size: 0.95rem; font-weight: 600; margin-bottom: 5px; min-height: 20px; }
    .message.error { color: var(--error-red); }
    .message.success { color: var(--racing-green); }
    .message.hint { color: var(--accent-gold); }

    /* Animaciones */
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      50% { transform: translateX(10px); }
      75% { transform: translateX(-10px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 0.4s ease-in-out; }

    /* Confeti */
    .confetti {
      position: absolute;
      width: 10px; height: 10px;
      background-color: #f00;
      animation: fall linear forwards;
      z-index: 5;
    }
    @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }

    /* Reproductores Ocultos (Fuera de pantalla) */
    .hidden-player { position: absolute; left: -9999px; top: -9999px; }

  </style>
</head>
<body>



  <!-- REPRODUCTORES YOUTUBE OCULTOS -->
  <!-- ID de Acierto: Fuente de Cacho / Himno -->
  <div id="win-player" class="hidden-player"></div>
  <!-- ID de Fallo: Sonido Fail / Sad Trombone -->
  <div id="fail-player" class="hidden-player"></div>

  <!-- PANTALLA INICIO -->
  <div id="startScreen" class="container">
    <h1>¬øConoces al Racing?</h1>
    <h2>Adivina al Jugador</h2>
    <p>Demuestra que eres un verdadero racinguista.</p>
    <ul style="text-align: left; margin: 20px; font-size:0.9rem; color:#555;">
    <button id="startButton" class="btn-primary">¬°Comenzar Juego!</button>
  </div>

  <!-- JUEGO PRINCIPAL -->
  <div id="gameContainer" class="container" style="display:none;">
    <div class="stats-bar">
      <span id="progressCounter">1 / 8</span>
      <span id="scoreCounter">Puntos: 0</span>
    </div>

    <div class="image-wrapper" id="imageWrapper">
      <img id="playerImage" src="" alt="Jugador Oculto">
      <div id="revealName"></div>
    </div>

    <div class="game-info">
      <p id="message" class="message"></p>
      <div id="livesDisplay" class="lives-container">‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <input type="text" id="guessInput" placeholder="Nombre del jugador..." autocomplete="off">
    
    <button id="guessButton" class="btn-primary">Comprobar</button>
    <button id="nextPlayerButton" class="btn-next">Siguiente Jugador</button>
  </div>

  <!-- PANTALLA FINAL -->
  <div id="finalScore" class="container" style="display:none;">
    <h1>¬°Fin del Partido!</h1>
    <div style="font-size: 4rem; margin: 20px 0;">üèÜ</div>
    <p id="finalScoreText" style="font-size: 1.2rem; margin-bottom: 20px;"></p>
    <button id="restartButton" class="btn-restart">Jugar de nuevo</button>
    <button id="exitButton" class="btn-exit">Salir</button>
  </div>

  <!-- CARGA API YOUTUBE -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // --- DATOS ---
    const players = [
      { name: "Jokin Ezkieta", aliases: ["jokin", "ezkieta"], position: "Portero", image: "imagenes/jugador0.jpg" },
      { name: "Mario Garcia", aliases: ["mario", "mario garcia"], position: "Lateral Izquierdo", image: "imagenes/jugador1.jpg" },
      { name: "Jorge Salinas", aliases: ["salinas", "jorge salinas"], position: "Lateral Izquierdo", image: "imagenes/jugador2.jpg" },
      { name: "Javi Castro", aliases: ["castro", "javi castro"], position: "Defensa Central", image: "imagenes/jugador3.jpg" },
      { name: "Marco Sangalli", aliases: ["sangalli", "marco"], position: "Extremo/Delantero", image: "imagenes/jugador4.jpg" },
      { name: "Jeremy", aliases: ["jeremy", "arevalo"], position: "Delantero", image: "imagenes/jugador5.jpg" },
      { name: "Asier Villalibre", aliases: ["villalibre", "asier", "bufalo"], position: "Delantero", image: "imagenes/jugador6.jpg" },
      { name: "Andr√©s Mart√≠n", aliases: ["andres", "martin", "andres martin"], position: "Extremo Derecho", image: "imagenes/jugador7.jpg" }
    ];

    // --- CONFIGURACI√ìN YOUTUBE ---
    const WIN_VIDEO_ID = ''; // Fuente de Cacho
    const FAIL_VIDEO_ID = 'CQeezCdF4mk'; // Fail Sound

    let playerWin, playerFail;
    let isMuted = false;

    function onYouTubeIframeAPIReady() {
      playerWin = new YT.Player('win-player', {
        height: '0', width: '0',
        videoId: WIN_VIDEO_ID,
        playerVars: { 'playsinline': 1, 'controls': 0 }
      });

      playerFail = new YT.Player('fail-player', {
        height: '0', width: '0',
        videoId: FAIL_VIDEO_ID,
        playerVars: { 'playsinline': 1, 'controls': 0 }
      });
    }

    function playSound(type) {
      if (isMuted) return;
      stopSounds();
      
      if (type === 'win' && playerWin && playerWin.playVideo) {
        playerWin.seekTo(0);
        playerWin.playVideo();
      } else if (type === 'fail' && playerFail && playerFail.playVideo) {
        playerFail.seekTo(0);
        playerFail.playVideo();
      }
    }

    function stopSounds() {
      if (playerWin && playerWin.stopVideo) playerWin.stopVideo();
      if (playerFail && playerFail.stopVideo) playerFail.stopVideo();
    }

    // --- VARIABLES DE ESTADO ---
    let currentIndex = 0;
    let lives = 2;
    let score = 0;
    let gameActive = false;

    // --- ELEMENTOS DOM ---
    const screens = {
      start: document.getElementById("startScreen"),
      game: document.getElementById("gameContainer"),
      end: document.getElementById("finalScore")
    };
    
    const ui = {
      img: document.getElementById("playerImage"),
      wrapper: document.getElementById("imageWrapper"),
      reveal: document.getElementById("revealName"),
      input: document.getElementById("guessInput"),
      btnGuess: document.getElementById("guessButton"),
      btnNext: document.getElementById("nextPlayerButton"),
      message: document.getElementById("message"),
      lives: document.getElementById("livesDisplay"),
      progress: document.getElementById("progressCounter"),
      score: document.getElementById("scoreCounter"),
      soundBtn: document.getElementById("soundToggle")
    };

    // --- UTILIDADES ---
    const normalize = (str) => str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim();

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function createConfetti() {
      for(let i=0; i<30; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.animationDuration = Math.random() * 2 + 2 + 's';
        confetti.style.backgroundColor = ['#006a38', '#c5a059', '#fff'][Math.floor(Math.random()*3)];
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 4000);
      }
    }

    // --- L√ìGICA DEL JUEGO ---

    function initGame() {
      shuffle(players);
      currentIndex = 0;
      score = 0;
      stopSounds();
      screens.start.style.display = 'none';
      screens.end.style.display = 'none';
      screens.game.style.display = 'block';
      loadLevel();
    }

    function loadLevel() {
      stopSounds(); 
      if (currentIndex >= players.length) {
        endGame();
        return;
      }

      gameActive = true;
      lives = 2;
      const p = players[currentIndex];

      ui.img.src = p.image;
      ui.img.style.filter = "grayscale(100%) blur(2px)";
      ui.img.style.clipPath = "circle(15% at 50% 20%)"; // Muy oculto
      
      ui.wrapper.classList.remove('revealed');
      ui.input.value = "";
      ui.input.disabled = false;
      ui.input.focus();
      ui.btnGuess.style.display = "inline-block";
      ui.btnNext.style.display = "none";
      ui.message.textContent = "üîç ¬øQui√©n es este jugador?";
      ui.message.className = "message";
      
      updateStats();
    }

    function updateStats() {
      ui.progress.textContent = `Jugador ${currentIndex + 1} / ${players.length}`;
      ui.score.textContent = `Puntos: ${score}`;
      ui.lives.textContent = lives === 2 ? "‚ù§Ô∏è‚ù§Ô∏è" : (lives === 1 ? "‚ù§Ô∏èü§ç" : "ü§çü§ç");
    }

    function checkGuess() {
      if (!gameActive) return;
      const userText = normalize(ui.input.value);
      const player = players[currentIndex];
      const isCorrect = userText === normalize(player.name) || 
                        player.aliases.some(alias => normalize(alias) === userText);

      if (isCorrect) handleWin(player);
      else handleFail(player);
    }

    function handleWin(player) {
      gameActive = false;
      score++;
      ui.message.textContent = "¬°GOL! ¬°CORRECTO! ‚öΩ";
      ui.message.className = "message success";
      createConfetti();
      playSound('win'); 
      endTurn(player.name, true);
    }

    function handleFail(player) {
      lives--;
      updateStats();
      screens.game.classList.add('shake');
      setTimeout(() => screens.game.classList.remove('shake'), 400);

      if (lives === 1) {
        ui.message.textContent = `Pista: Es ${player.position}`;
        ui.message.className = "message hint";
        // Pista: Se abre un poco, pero no mucho
        ui.img.style.clipPath = "circle(25% at 50% 30%)"; 
        ui.input.value = "";
        ui.input.focus();
      } else {
        gameActive = false;
        ui.message.textContent = "¬°Se acabaron las vidas! ‚ùå";
        ui.message.className = "message error";
        playSound('fail'); 
        endTurn(player.name, false); // false = perdi√≥
      }
    }

    function endTurn(name, won) {
      ui.input.disabled = true;
      ui.btnGuess.style.display = "none";
      ui.btnNext.style.display = "inline-block";
      ui.reveal.textContent = name;
      ui.wrapper.classList.add('revealed');

      if (won) {
        // ACIERTO: Se ve a color, pero con un recorte elegante (no completo del todo)
        ui.img.style.filter = "grayscale(0%)";
        ui.img.style.clipPath = "inset(0 0 20% 0)"; 
      } else {
        // FALLO (Vidas = 0): Se ve COMPLETAMENTE para que el usuario sepa qui√©n era
        ui.img.style.filter = "grayscale(0%)";
        ui.img.style.clipPath = "inset(0 0 0 0)"; 
      }
    }

    function endGame() {
      stopSounds();
      screens.game.style.display = 'none';
      screens.end.style.display = 'block';
      const resultElement = document.getElementById("finalScoreText");
      
      let msg = "";
      if (score === players.length) msg = "¬°INCRE√çBLE! ¬°Pleno absoluto!";
      else if (score > players.length / 2) msg = "¬°Muy bien! Conoces al equipo.";
      else msg = "Necesitas ir m√°s al Sardinero...";

      resultElement.innerHTML = `Has acertado <strong style="color:var(--racing-green)">${score}</strong> de ${players.length}.<br><br>${msg}`;
    }

    // --- EVENT LISTENERS ---
    document.getElementById("startButton").addEventListener("click", initGame);
    ui.btnGuess.addEventListener("click", checkGuess);
    ui.btnNext.addEventListener("click", () => { currentIndex++; loadLevel(); });
    document.getElementById("restartButton").addEventListener("click", initGame);
    document.getElementById("exitButton").addEventListener("click", () => window.close());
    
    ui.input.addEventListener("keypress", (e) => { if (e.key === "Enter") checkGuess(); });

    ui.soundBtn.addEventListener("click", () => {
      isMuted = !isMuted;
      ui.soundBtn.textContent = isMuted ? "üîá" : "üîä";
      if(isMuted) stopSounds();
    });

  </script>
</body>
</html>
